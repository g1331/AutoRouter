## Context

当前前端已经形成完整的 `Cassette Futurism` 视觉体系，且该体系在以下层面深度耦合：

- 全局样式与令牌：`src/app/globals.css`、`tailwind.config.ts`
- 基础组件外观：`src/components/ui/*`
- 壳层结构：`src/components/admin/sidebar.tsx`、`src/components/admin/topbar.tsx`、`src/app/[locale]/(dashboard)/layout.tsx`
- 关键页面：`src/app/[locale]/(dashboard)/*/page.tsx`
- 数据展示：`src/components/dashboard/*`、`src/components/admin/*table*.tsx`

现状问题不是局部样式问题，而是“视觉语言本体”与“业务界面结构”绑定过深。若继续小修小补，会持续放大维护成本和视觉不一致问题，因此需要完整替换视觉基座，同时保持业务行为不变。

关键约束：

- 不改后端接口与业务语义，只改前端视觉与交互表达。
- 需同时覆盖桌面与移动端。
- 需保留可访问性（`prefers-reduced-motion`、对比度、键盘焦点）能力。

## Goals / Non-Goals

**Goals:**

- 完整废弃当前终端复古视觉（配色、纹理、发光、扫描线、CRT 动效）。
- 建立新视觉基座（令牌、字体、层级、动效、状态反馈）并落到全局样式和 Tailwind 扩展。
- 统一管理台壳层与五个核心页面（Dashboard、Keys、Upstreams、Logs、Settings）的视觉结构。
- 统一数据密集场景的组件规则（表格、图表、卡片、表单、弹窗、空态、错误态、加载态）。
- 保证桌面与移动端在视觉语义上一致，布局上各自最优。
- 建立“精致、克制、功能导向”的管理台视觉气质，避免炫技化表达。

**Non-Goals:**

- 不调整 API 协议、请求流程、鉴权逻辑、数据库结构。
- 不新增页面业务能力，仅做视觉与交互表达重构。
- 不在本次重构中引入额外前端框架迁移（例如改用全新 UI 框架）。

## Decisions

### Decision 1: 建立全新视觉令牌命名空间并移除旧语义映射

- 决策：新建视觉令牌命名空间（例如 `--vr-*`），并替换 `globals.css` 与 `tailwind.config.ts` 对旧 `cf-*` 变量的依赖。
- 原因：旧令牌语义天然绑定“琥珀终端风”，继续沿用会把旧风格隐性带入新界面。
- 备选方案：
  - 方案 A：在旧 `cf-*` 上覆写取值。缺点是技术债重、语义混乱、迁移不可控。
  - 方案 B（采纳）：新旧隔离，逐页迁移后删旧变量。优点是边界清晰，可回滚可验证。

### Decision 2: 壳层先行，页面后迁移

- 决策：优先重构壳层（侧边栏/顶部栏/主容器），再重构页面内容组件。
- 原因：壳层定义了视觉基线（间距、背景、层级、导航反馈），先定壳层可减少后续返工。
- 备选方案：
  - 方案 A：按页面独立改。缺点是跨页不一致概率高。
  - 方案 B（采纳）：壳层先行，页面按统一框架落地。

### Decision 3: 数据密集场景采用“可读性优先”的中性视觉

- 决策：表格、图表、日志流视图采用低噪声背景 + 清晰边界 + 强状态色点缀，不再使用高频装饰动效。
- 原因：Keys/Upstreams/Logs 为高频操作与排障场景，读写效率优先于视觉炫技。
- 备选方案：
  - 方案 A：保留部分装饰特效。缺点是注意力分散，信息密度高时干扰显著。
  - 方案 B（采纳）：状态驱动视觉，装饰退后。

### Decision 4: 动效采用“有意义且可降级”的策略

- 决策：仅保留页面进入、分组切换、操作反馈三类关键动效，统一时长和缓动曲线，并默认支持 reduced-motion。
- 原因：当前动效类型过多且分散，维护成本高，且部分动效对信息理解无增益。
- 备选方案：
  - 方案 A：保留现有丰富动效并局部改。缺点是复杂度高且一致性难控。
  - 方案 B（采纳）：收敛为最小但有效的动效系统。

### Decision 5: 以组件契约驱动页面替换，避免一次性硬切

- 决策：先统一基础组件契约（Button/Card/Table/Input/Select/Badge/Dialog），页面只消费新契约。
- 原因：页面文件分散，若逐页写死样式将再次走向失控。
- 备选方案：
  - 方案 A：页面内直接重写 className。缺点是重复和偏差不可避免。
  - 方案 B（采纳）：组件契约先稳定，再迁移页面。

### Decision 6: 配色与背景表达采用“中性底色 + 弱强调色”，禁止大面积蓝紫纯色与强渐变

- 决策：整体采用中性底色体系，强调色仅用于关键 CTA、状态提示和焦点反馈；禁止在大面积背景使用蓝紫纯色或高饱和蓝紫渐变。
- 原因：管理台核心目标是信息读取与决策效率，大面积强色和强渐变会造成视觉疲劳并弱化数据层级。
- 备选方案：
  - 方案 A：继续使用高饱和主色大面积铺底。缺点是可读性与专业感下降。
  - 方案 B（采纳）：中性基底 + 低占比强调色，兼顾精致感与功能性。

### Decision 7: 图表使用明暗双套配色，但均遵循可读性优先

- 决策：图表在明暗主题下分别使用独立配色曲线，但颜色语义一致，且不使用炫目蓝紫主导背景。
- 原因：双套配色可在不同主题下保证对比度与辨识度，同时保持跨主题的语义连贯。
- 备选方案：
  - 方案 A：单套颜色自动映射。缺点是部分主题下对比度不可控。
  - 方案 B（采纳）：双套配色并统一语义映射规则。

## 关键场景布局示意

### 桌面端壳层（>= md）

```text
+----------------------------------------------------------------------------------+
| Sidebar (fixed) | Main Area                                                      |
| - Brand         | +------------------------------------------------------------+ |
| - Nav           | | Page Header / Breadcrumb / Actions                         | |
| - Utilities     | +------------------------------------------------------------+ |
|                 | | Content Section 1 (stats/cards/table/chart)                | |
|                 | +------------------------------------------------------------+ |
|                 | | Content Section 2                                           | |
|                 | +------------------------------------------------------------+ |
+----------------------------------------------------------------------------------+
```

### 移动端壳层（< md）

```text
+---------------------------------------------+
| Main Content (scrollable)                   |
| - Header block                              |
| - Content blocks                            |
| - Bottom safe-area spacing                  |
+---------------------------------------------+
| Bottom Navigation (fixed, 5 tabs)           |
+---------------------------------------------+
```

### Dashboard 视觉层级（示意）

| 层级 | 区域 | 视觉角色 | 信息优先级 |
| --- | --- | --- | --- |
| L1 | 顶部标题区 | 页面定位与上下文 | 高 |
| L2 | 核心指标卡 | 关键运行状态 | 高 |
| L3 | 趋势图与榜单 | 分析与决策支持 | 中 |
| L4 | 快捷操作与系统信息 | 次要操作与补充状态 | 中低 |

## Risks / Trade-offs

- [风险] 样式替换范围过大，容易出现跨页视觉不一致。 → Mitigation：先冻结组件契约，再按页面清单迁移并逐页验收。
- [风险] 移除旧特效后，部分用户主观感知“个性降低”。 → Mitigation：通过新的品牌元素与关键动效保持辨识度，但不牺牲可读性。
- [风险] 移动端布局在大表格场景可能出现拥挤。 → Mitigation：为数据表提供移动端卡片视图与关键字段折叠策略。
- [风险] 一次重构导致回归点增多。 → Mitigation：按模块分阶段提交，并对关键页面进行手工回归清单验证。
- [风险] 对蓝紫与强渐变的限制可能压缩视觉探索空间。 → Mitigation：通过材质细节、排版层次与微交互提升精致感，而非依赖大面积强色。

## Migration Plan

1. 建立新视觉令牌与 Tailwind 映射，保留旧样式但不再新增引用。
2. 重构基础组件契约（Button/Card/Table/Input/Select/Badge/Dialog），补齐状态样式。
3. 重构壳层（Sidebar/Topbar/Layout），完成桌面与移动端导航统一。
4. 依次迁移五个核心页面（Dashboard → Keys → Upstreams → Logs → Settings）。
5. 清理所有 `cf-*` 风格类与旧动效定义，删除无效样式和未使用令牌。
6. 执行视觉回归与响应式验收，完成最终切换。

回滚策略：

- 若阶段性问题严重，可回退到上一个稳定提交点；由于迁移按模块推进，不需要整仓回滚。

## Open Questions

- 无。已确认采用“中性底色 + 弱强调色”策略，并采用图表明暗双套配色方案。
