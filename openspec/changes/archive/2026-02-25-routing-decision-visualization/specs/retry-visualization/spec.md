# Retry Visualization

## Overview

å¯è§†åŒ–æ•…éšœè½¬ç§»é‡è¯•è¿‡ç¨‹ï¼Œå±•ç¤ºæ¯æ¬¡å°è¯•çš„è¯¦ç»†ä¿¡æ¯ï¼šæ—¶é—´æˆ³ã€ä¸Šæ¸¸ã€é”™è¯¯ç±»å‹ã€è€—æ—¶ï¼Œè®©ç”¨æˆ·æ¸…æ™°çœ‹åˆ°"å°è¯•äº†å“ªäº›ä¸Šæ¸¸ã€ä¸ºä»€ä¹ˆå¤±è´¥ã€æœ€ç»ˆå“ªä¸ªæˆåŠŸ"ã€‚

## Requirements

### Functional Requirements

1. **é‡è¯•æ—¶é—´çº¿**
   - ä»¥æ—¶é—´çº¿å½¢å¼å±•ç¤ºæ¯æ¬¡å°è¯•ï¼ˆAttempt 1, 2, 3...ï¼‰
   - æ¯æ¬¡å°è¯•æ˜¾ç¤ºï¼š
     - æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰
     - ä¸Šæ¸¸åç§°
     - é€‰æ‹©çŠ¶æ€ï¼ˆâ— é€‰ä¸­ï¼‰
     - ç»“æœï¼ˆâœ“ æˆåŠŸ æˆ– âš¡ å¤±è´¥ï¼‰
     - é”™è¯¯ç±»å‹ï¼ˆå¦‚å¤±è´¥ï¼‰
     - çŠ¶æ€ç ï¼ˆå¦‚é€‚ç”¨ï¼‰

2. **æˆåŠŸå°è¯•é«˜äº®**
   - æœ€ç»ˆæˆåŠŸçš„å°è¯•ä½¿ç”¨ç»¿è‰²èƒŒæ™¯æˆ–è¾¹æ¡†é«˜äº®
   - æ˜¾ç¤º "âœ“ SUCCESS" æ ‡ç­¾

3. **å¤±è´¥åŸå› å±•ç¤º**
   - å¤±è´¥çš„å°è¯•æ˜¾ç¤ºé”™è¯¯ç±»å‹å›¾æ ‡
   - é”™è¯¯ç±»å‹åŒ…æ‹¬ï¼štimeoutã€http_5xxã€http_429ã€connection_errorã€circuit_open
   - hover æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯

4. **æ€§èƒ½æŒ‡æ ‡**
   - å±•ç¤ºæ•…éšœè½¬ç§»æ€»è€—æ—¶ï¼ˆä»é¦–æ¬¡å¤±è´¥åˆ°æœ€ç»ˆæˆåŠŸï¼‰
   - å±•ç¤ºæ¯æ¬¡å°è¯•çš„è€—æ—¶
   - å±•ç¤ºå°è¯•æ¬¡æ•°ç»Ÿè®¡ï¼ˆå¦‚"2 æ¬¡å¤±è´¥ â†’ ç¬¬ 3 æ¬¡æˆåŠŸ"ï¼‰

5. **é™åˆ¶å±•ç¤ºæ•°é‡**
   - æœ€å¤šå±•ç¤º 5 æ¬¡å°è¯•
   - è¶…å‡ºæ—¶æ˜¾ç¤º"...è¿˜æœ‰ N æ¬¡å°è¯•æœªå±•ç¤º"

### Non-Functional Requirements

- æ—¶é—´æˆ³ä½¿ç”¨ç­‰å®½å­—ä½“ï¼Œä¾¿äºå¯¹é½å’Œæ‰«æ
- é”™è¯¯ç±»å‹ä½¿ç”¨é¢œè‰²ç¼–ç ï¼ˆçº¢è‰² = å¤±è´¥ï¼Œç»¿è‰² = æˆåŠŸï¼‰
- ä¿æŒä¸ç°æœ‰ç»ˆç«¯é£æ ¼ä¸€è‡´çš„è§†è§‰è®¾è®¡

## Data Structure

```typescript
interface FailoverAttempt {
  upstream_id: string;
  upstream_name: string;
  attempted_at: string; // ISO timestamp
  error_type: "timeout" | "http_5xx" | "http_4xx" | "http_429" | "connection_error" | "circuit_open";
  error_message: string;
  status_code?: number | null;
}

interface RetryVisualizationProps {
  failoverHistory: FailoverAttempt[];
  failoverDurationMs: number;
  finalSuccess: boolean;
}
```

## UI Design

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â‘£ EXECUTION & RETRIES                                  â”‚
â”‚                                                         â”‚
â”‚  Attempt 1                                              â”‚
â”‚    14:32:01.234  premium-openai  â—                      â”‚
â”‚    14:32:03.567  âš¡ HTTP 503  â†’  è§¦å‘æ•…éšœè½¬ç§»            â”‚
â”‚    è€—æ—¶: 2.333s                                         â”‚
â”‚                                                         â”‚
â”‚  Attempt 2                                              â”‚
â”‚    14:32:03.589  rc  â—                                  â”‚
â”‚    14:32:04.123  âš¡ Timeout  â†’  è§¦å‘æ•…éšœè½¬ç§»             â”‚
â”‚    è€—æ—¶: 0.534s                                         â”‚
â”‚                                                         â”‚
â”‚  Attempt 3  âœ“ SUCCESS                                   â”‚
â”‚    14:32:04.145  backup-openai  â—                       â”‚
â”‚    14:32:06.890  âœ“ 200 OK                               â”‚
â”‚    è€—æ—¶: 2.745s                                         â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚  æ•…éšœè½¬ç§»è€—æ—¶: 3.656s  (2 æ¬¡å¤±è´¥ â†’ ç¬¬ 3 æ¬¡æˆåŠŸ)          â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Type Display

| é”™è¯¯ç±»å‹ | å›¾æ ‡ | æ˜¾ç¤ºæ–‡å­— |
|----------|------|----------|
| timeout | â±ï¸ | è¶…æ—¶ |
| http_5xx | âš¡ | æœåŠ¡å™¨é”™è¯¯ |
| http_429 | ğŸš« | è¯·æ±‚é™åˆ¶ |
| http_4xx | âŒ | å®¢æˆ·ç«¯é”™è¯¯ |
| connection_error | ğŸ”Œ | è¿æ¥é”™è¯¯ |
| circuit_open | ğŸš§ | ç†”æ–­å¼€å¯ |

## i18n

æ–°å¢ç¿»è¯‘é”®ï¼š
- `retry.attempt`
- `retry.success`
- `retry.failoverTriggered`
- `retry.duration`
- `retry.totalDuration`
- `retry.attemptsSummary`
- `errorType.timeout`
- `errorType.http_5xx`
- `errorType.http_429`
- `errorType.connection_error`
- `errorType.circuit_open`

## Testing

- å•å…ƒæµ‹è¯•ï¼šéªŒè¯ä¸åŒæ•°é‡çš„å°è¯•æ­£ç¡®æ¸²æŸ“
- è¾¹ç•Œæµ‹è¯•ï¼šéªŒè¯è¶…è¿‡ 5 æ¬¡å°è¯•æ—¶æ­£ç¡®æˆªæ–­
- äº¤äº’æµ‹è¯•ï¼šéªŒè¯ hover æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
