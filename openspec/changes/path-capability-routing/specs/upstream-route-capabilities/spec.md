## ADDED Requirements

### Requirement: 上游支持多能力配置
系统 SHALL 允许单个上游配置多个能力类型，并将该配置作为路径路由候选过滤的依据。

#### Scenario: 创建上游时配置多个能力
- **WHEN** 管理员创建上游并提交多个能力类型
- **THEN** 系统持久化完整能力集合并在后续选路中生效

#### Scenario: 更新上游能力集合
- **WHEN** 管理员在编辑上游时新增或移除能力类型
- **THEN** 系统更新存储并立即用于后续路由决策

### Requirement: 能力配置输入校验
系统 SHALL 对上游能力配置执行严格校验，拒绝未知能力类型和空能力项。

#### Scenario: 提交未知能力类型
- **WHEN** 管理端请求包含未定义能力标识
- **THEN** 系统返回参数校验错误并拒绝写入

#### Scenario: 提交空能力项
- **WHEN** 管理端请求中能力数组包含空字符串或重复项
- **THEN** 系统移除非法值并返回规范化后的能力集合或报错

### Requirement: 旧配置到新能力的默认迁移
系统 SHALL 在升级后将历史能力配置规范化，并移除对 `provider_type` 默认映射的依赖。

#### Scenario: 历史能力集合规范化
- **WHEN** 迁移任务扫描到历史上游能力数组包含空字符串、重复项或非法值
- **THEN** 系统写回规范化后的能力集合，仅保留合法且去重后的能力项

#### Scenario: 历史 provider 字段清理
- **WHEN** 系统完成能力路由迁移
- **THEN** 后续数据模型与接口契约不再要求 `provider_type` 字段存在

### Requirement: 管理端图标化展示多能力状态
系统 SHALL 在上游管理界面以“图标 + 文案”展示每个上游已启用的能力，并支持一个上游同时展示多个能力图标。

#### Scenario: 上游列表展示能力标签
- **WHEN** 管理员打开上游列表
- **THEN** 每个上游条目以图标徽章方式显示完整能力集合（包含文案，不得仅显示图标）

#### Scenario: 上游编辑弹窗展示能力多选
- **WHEN** 管理员打开上游编辑弹窗
- **THEN** 页面提供图标化能力多选组件并回显当前已配置值

#### Scenario: 单上游配置多个能力时完整回显
- **WHEN** 某上游同时配置 `anthropic_messages` 与 `openai_chat_compatible`
- **THEN** 列表和编辑态都同时显示两个能力图标徽章，不得折叠为单一文本

#### Scenario: 图标资源不可用时的兜底展示
- **WHEN** 某能力类型对应图标资源加载失败
- **THEN** 系统使用通用兜底图标并保留能力文案，确保语义不丢失
